<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Content Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .section-card {
            border: 1px solid #e5e7eb;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-7xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <h1 class="text-4xl font-black text-indigo-700 mb-2">Portfolio Content Editor</h1>
        <p class="text-gray-600 mb-8">Edit your project data below. When done, copy the generated code and paste it into the **`projects_data.js`** file.</p>

        <div id="project-list" class="space-y-6">
            <!-- Project Selector will be injected here -->
        </div>

        <!-- Project Editing Form -->
        <div id="editing-area" class="mt-10 p-6 border border-gray-200 rounded-lg bg-white shadow-inner hidden">
            <h2 class="text-2xl font-bold mb-4">Edit Project: <span id="edit-title" class="text-indigo-600"></span></h2>
            
            <form id="project-form" class="space-y-6">
                
                <h3 class="text-xl font-semibold border-b pb-2 mb-4">A. General Project Info</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">ID (Read-Only)</label>
                        <input type="text" id="id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-gray-50 p-2" readonly>
                    </div>
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700">Project Title</label>
                        <input type="text" id="title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
                        <input type="text" id="category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="year" class="block text-sm font-medium text-gray-700">Year</label>
                        <input type="number" id="year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="accentColor" class="block text-sm font-medium text-gray-700">Accent Color (Tailwind Class)</label>
                        <input type="text" id="accentColor" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., bg-indigo-600">
                    </div>
                </div>

                <div>
                    <label for="heroImage" class="block text-sm font-medium text-gray-700">Hero Image URL</label>
                    <input type="url" id="heroImage" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <!-- HIDE PROJECT CHECKBOX -->
                <div class="flex items-center space-x-3 p-3 border border-red-300 bg-red-50 rounded-md">
                    <input type="checkbox" id="isHidden" class="rounded text-red-600 focus:ring-red-500">
                    <label for="isHidden" class="text-base font-medium text-red-700">Hide Project (Draft Mode)</label>
                    <p class="text-xs text-red-600">(If checked, this project will NOT appear on the live site.)</p>
                </div>
                
                <h3 class="text-xl font-semibold border-b pb-2 mb-4 pt-4">B. Modal Intro & Details</h3>

                <div>
                    <label for="brief" class="block text-sm font-medium text-gray-700">Brief (Modal Intro Summary)</label>
                    <textarea id="brief" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 border p-4 rounded-md bg-gray-50">
                    <div class="flex flex-col">
                        <div class="flex items-center space-x-2 mb-1">
                            <input type="checkbox" id="enableClient" class="rounded text-indigo-600 focus:ring-indigo-500">
                            <label for="enableClient" class="text-sm font-medium text-gray-700">Client</label>
                        </div>
                        <input type="text" id="client" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex flex-col">
                        <div class="flex items-center space-x-2 mb-1">
                            <input type="checkbox" id="enableRole" class="rounded text-indigo-600 focus:ring-indigo-500">
                            <label for="enableRole" class="text-sm font-medium text-gray-700">Role</label>
                        </div>
                        <input type="text" id="role" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex flex-col">
                        <div class="flex items-center space-x-2 mb-1">
                            <input type="checkbox" id="enableDuration" class="rounded text-indigo-600 focus:ring-indigo-500">
                            <label for="enableDuration" class="text-sm font-medium text-gray-700">Duration</label>
                        </div>
                        <input type="text" id="duration" class="block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>
                
                <h3 class="text-xl font-semibold border-b pb-2 mb-4 pt-4">C. Case Study Sections</h3>
                <div id="sections-container" class="space-y-4">
                    <!-- Dynamic section fields will be injected here -->
                </div>
                
                <button type="button" onclick="addSectionField()" class="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">
                    âž• Add New Section
                </button>
                
            </form>
            
            <!-- Combined Save, Generate, and Copy Button -->
            <button onclick="saveChanges()" class="mt-6 w-full inline-flex justify-center py-3 px-4 border border-transparent shadow-sm text-lg font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Save, Generate, & Copy Code
            </button>
        </div>

        <!-- Output Area -->
        <div class="mt-10 p-6 border-t pt-8">
            <h2 class="text-3xl font-bold mb-4">Generated Project Data (Copy/Paste OVERWHOLE FILE)</h2>
            <p class="text-sm text-red-600 mb-4">ðŸš¨ **CRITICAL STEP:** Copy ALL text below and **REPLACE THE ENTIRE CONTENTS** of your **`projects_data.js`** file with it.</p>
            <textarea id="js-output" rows="20" class="w-full rounded-md border-gray-300 shadow-sm p-3 border font-mono text-xs bg-gray-800 text-green-300" readonly></textarea>
        </div>
    </div>

    <script>
        // --- ADMIN PANEL CORE DATA (Seeding the editor with the current project data) ---
        // NOTE: This data should be kept in sync with projects_data.js content
        let currentProjects = [
            // Project 1
            {
                id: 'project-1', title: 'FlowState App: Meditation & Sleep', category: 'UI/UX Mobile App', year: '2024',
                heroImage: 'https://placehold.co/800x600/1e293b/f1f5f9?text=FlowState+Mobile+Hero', accentColor: 'bg-indigo-600', 
                isHidden: false, // NEW PROPERTY
                caseStudy: {
                    client: 'FlowState Wellness', role: 'Lead UX/UI Designer', duration: '4 Months',
                    brief: 'A complete redesign of a mindfulness application focused on reducing friction in the daily tracking process and enhancing the visual language for a calm user experience.',
                    sections: [
                        { id: 'problem', title: '01. The Problem & Goal', content: 'The existing app suffered from high churn rates (35% after the first week) primarily due to an overwhelming onboarding process and a dated visual style that lacked emotional connection. The core goal was to simplify the daily tracking routine to increase retention and daily active usage (DAU) by 20%.', media: 'https://placehold.co/1200x600/334155/e2e8f0?text=UX+Wireframing+and+User+Flows' },
                        { id: 'research', title: '02. User Research & Flows', content: 'We conducted qualitative interviews with 20 active users and built new user flow maps, finding that the key moment of friction was choosing a guided session. The initial step was consolidating decision points and creating an intuitive "Quick Start" button.' },
                        { id: 'visual', title: '04. Visual Design & System', content: 'I developed a soft, dark-mode-first design system using gentle curves and large, legible typography (Figtree). The visual style was minimal, using subtle gradients to create depth without distraction. This premium aesthetic was designed to evoke calm and focus.', media: 'https://placehold.co/1200x700/6366f1/ffffff?text=FlowState+Final+UI+Mockups' },
                    ],
                }
            },
            // Project 2
            {
                id: 'project-2', title: 'Evolve Agency: Corporate Rebrand', category: 'Visual Identity & Web Design', year: '2023',
                heroImage: 'https://placehold.co/800x450/475569/f8fafc?text=Evolve+Web+Design+Hero', accentColor: 'bg-green-600',
                isHidden: false, // NEW PROPERTY
                caseStudy: {
                    client: 'Evolve Marketing', role: 'Visual Designer', duration: '2 Months',
                    brief: 'A full-scale digital and visual identity rebrand for a marketing agency, establishing authority and modernity in their segment.',
                    sections: [
                        { id: 'problem', title: '01. The Dated Brand', content: 'The old brand identity felt stale and didn\'t convey the agency\'s cutting-edge work. The goal was to create a modular, adaptable visual system that works across digital and print.' },
                        { id: 'strategy', title: '02. Color & Typography Strategy', content: 'We moved to a deep navy and forest green palette to evoke trust and growth, paired with a sharp, geometric sans-serif font for professionalism. The website design focused on bold, asymmetrical content blocks.', media: 'https://placehold.co/1200x700/065f46/d1fae5?text=Brand+Identity+Guide+Cover' },
                    ],
                }
            },
            // Project 3
            {
                id: 'project-3', title: 'Local Market: E-commerce Platform', category: 'UX Research & E-commerce UI', year: '2023',
                heroImage: 'https://placehold.co/800x550/1f2937/f3f4f6?text=Local+Market+E-commerce+UI', accentColor: 'bg-yellow-600',
                isHidden: false, // NEW PROPERTY
                caseStudy: {
                    client: 'Farm-to-Table Collective', role: 'UX Consultant', duration: '3 Months',
                    brief: 'Designing an accessible and localized e-commerce platform for farmers and local producers, optimizing checkout conversion for a diverse user base.',
                    sections: [
                        { id: 'problem', title: '01. Accessibility Challenge', content: 'A strong focus was placed on WCAG AA compliance and a mobile-first approach due to the target demographic. Early user testing revealed critical friction points in the payment and delivery scheduling steps.', media: 'https://placehold.co/1200x500/78716c/fff7ed?text=User+Testing+Findings+Chart' },
                        { id: 'solution', title: '02. Streamlined Checkout', content: 'The solution was a simplified, three-step checkout process with large, clear button states and strong input validation. We also introduced a clear "local delivery map" visual to manage user expectations.', media: 'https://placehold.co/1200x700/f59e0b/000000?text=Mobile+Checkout+Flow+Optimization' }
                    ],
                }
            },
            // Project 4
            { 
                id: 'project-4', title: 'Aero SaaS: Data Visualization', category: 'UI/UX Dashboard', year: '2023', 
                heroImage: 'https://placehold.co/800x600/111827/d1d5db?text=Aero+SaaS+Dashboard+Hero', accentColor: 'bg-red-600', 
                isHidden: false, // NEW PROPERTY
                caseStudy: { 
                    client: 'Aero Dynamics', role: 'UI Lead', duration: '5 Months',
                    brief: 'Designing a complex SaaS dashboard for data visualization, focusing on clarity, speed, and customization for enterprise users.',
                    sections: [
                        { id: 'challenge', title: '01. Data Density Challenge', content: 'The primary challenge was managing information density without causing cognitive overload. We implemented a modular widget system and dark mode interface to reduce eye strain during long working hours.', media: 'https://placehold.co/1200x800/dc2626/fef2f2?text=SaaS+Dashboard+Dark+Mode+View' },
                    ],
                }
            },
            // Project 5
            { 
                id: 'project-5', title: 'Venture Fund: Investor Portal', category: 'Web UX/UI', year: '2022', 
                heroImage: 'https://placehold.co/800x450/4f46e5/ffffff?text=Venture+Portal+UX', accentColor: 'bg-pink-600', 
                isHidden: false, // NEW PROPERTY
                caseStudy: { 
                    client: 'Ascend Capital', role: 'UX Designer', duration: '3 Months',
                    brief: 'Creating a secure, high-end investor portal to manage fund performance, documents, and communication.',
                    sections: [
                        { id: 'security', title: '01. Security & Trust', content: 'Security and trust were paramount. The design utilized a highly structured layout with clean, authoritative typography and minimal colors to project confidence and stability.', media: 'https://placehold.co/1200x600/be185d/fce7f3?text=Investor+Portal+Security+Features' },
                    ],
                }
            },
            // Project 6
            { 
                id: 'project-6', title: 'Aura Campaign: Lifestyle Visuals', category: 'Social Media Design', year: '2024', 
                heroImage: 'https://placehold.co/800x600/a855f7/f3e8ff?text=Social+Campaign+Visuals', accentColor: 'bg-purple-600', 
                isHidden: false, // NEW PROPERTY
                caseStudy: { 
                    client: 'Aura Fitness', role: 'Visual Design Lead', duration: '1 Month',
                    brief: 'Development of a fresh, dynamic visual language for a 30-day Instagram campaign focused on wellness and hydration, designed to increase engagement and drive sign-ups.',
                    sections: [
                        { id: 'goal', title: '01. Campaign Goals & Aesthetics', content: 'The primary goal was a 50% increase in post saves and shares. We defined a soft, ethereal aesthetic using pastel gradients and clean, minimal typography, moving away from standard stock imagery.', media: 'https://placehold.co/1200x700/7c3aed/f3e8ff?text=Instagram+Feed+Mockup+-+Aura+Campaign' },
                    ],
                }
            },
            // Project 7
            { 
                id: 'project-7', title: 'QuickPost Templates: B2B Focus', category: 'Content Design System', year: '2023', 
                heroImage: 'https://placehold.co/800x600/15803d/dcfce7?text=B2B+LinkedIn+Templates', accentColor: 'bg-emerald-700', 
                isHidden: false, // NEW PROPERTY
                caseStudy: { 
                    client: 'QuickPost SaaS', role: 'UX/Content Designer', duration: '6 Weeks',
                    brief: 'Designing a modular template system for LinkedIn and Twitter aimed at accelerating content creation for a B2B SaaS marketing team while maintaining brand consistency.',
                    sections: [
                        { id: 'challenge', title: '01. Speed and Consistency', content: 'The marketing team struggled with slow content turnaround and inconsistent visual branding across channels. The objective was to design a system that allowed non-designers to produce branded content in under 5 minutes.', media: 'https://placehold.co/1200x500/059669/d1fae5?text=Modular+Template+Breakdown' },
                    ],
                }
            },
        ];

        let selectedProject = null;

        function initializeApp() {
            // Load data from localStorage if it exists
            const storedData = localStorage.getItem('portfolioProjects');
            if (storedData) {
                try {
                    currentProjects = JSON.parse(storedData);
                } catch (e) {
                    console.error("Failed to parse stored projects data, using default.", e);
                }
            }
            renderProjectList();
            updateJSOutput();
        }

        function renderProjectList() {
            const listDiv = document.getElementById('project-list');
            listDiv.innerHTML = '';

            const header = document.createElement('h2');
            header.className = 'text-2xl font-bold mb-4';
            header.textContent = 'Select Project to Edit (or create a new one):';
            listDiv.appendChild(header);
            
            // Add New Project button
            const newButton = document.createElement('button');
            newButton.className = 'mr-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 mb-4';
            newButton.textContent = 'âž• Add New Project';
            newButton.onclick = createNewProject;
            listDiv.appendChild(newButton);


            currentProjects.forEach((project, index) => {
                const button = document.createElement('button');
                // Highlight button if project is hidden
                const isHiddenClass = project.isHidden ? 'border-red-500 bg-red-100 text-red-700' : 'border-gray-300 text-gray-700 bg-white';
                button.className = `mr-4 mb-2 inline-flex items-center px-4 py-2 border text-sm font-medium rounded-md shadow-sm hover:bg-gray-50 ${isHiddenClass}`;
                button.textContent = `${index + 1}. ${project.title} ${project.isHidden ? ' (DRAFT)' : ''}`;
                button.onclick = () => selectProject(project.id);
                listDiv.appendChild(button);
            });
        }

        function selectProject(projectId) {
            selectedProject = currentProjects.find(p => p.id === projectId);
            
            document.getElementById('edit-title').textContent = selectedProject.title;
            document.getElementById('editing-area').classList.remove('hidden');

            // Populate General Info fields
            document.getElementById('id').value = selectedProject.id;
            document.getElementById('title').value = selectedProject.title;
            document.getElementById('category').value = selectedProject.category;
            document.getElementById('year').value = selectedProject.year;
            document.getElementById('heroImage').value = selectedProject.heroImage;
            document.getElementById('accentColor').value = selectedProject.accentColor;
            
            // Populate HIDE PROJECT checkbox
            document.getElementById('isHidden').checked = selectedProject.isHidden || false;

            // Populate Modal Intro & Details
            document.getElementById('brief').value = selectedProject.caseStudy.brief;
            
            // Populate Details fields (Client, Role, Duration)
            const clientVal = selectedProject.caseStudy.client || '';
            const roleVal = selectedProject.caseStudy.role || '';
            const durationVal = selectedProject.caseStudy.duration || '';

            document.getElementById('client').value = clientVal;
            document.getElementById('role').value = roleVal;
            document.getElementById('duration').value = durationVal;

            // Handle Checkboxes (enable/disable inputs)
            document.getElementById('enableClient').checked = !!clientVal;
            document.getElementById('client').disabled = !document.getElementById('enableClient').checked;
            document.getElementById('enableClient').onchange = (e) => document.getElementById('client').disabled = !e.target.checked;
            
            document.getElementById('enableRole').checked = !!roleVal;
            document.getElementById('role').disabled = !document.getElementById('enableRole').checked;
            document.getElementById('enableRole').onchange = (e) => document.getElementById('role').disabled = !e.target.checked;
            
            document.getElementById('enableDuration').checked = !!durationVal;
            document.getElementById('duration').disabled = !document.getElementById('enableDuration').checked;
            document.getElementById('enableDuration').onchange = (e) => document.getElementById('duration').disabled = !e.target.checked;

            // Render dynamic sections UI
            renderSections();
        }
        
        function createNewProject() {
            const newId = `project-${currentProjects.length + 1}`;
            const newProject = {
                id: newId, 
                title: 'NEW PROJECT TITLE', 
                category: 'New Category', 
                year: (new Date()).getFullYear().toString(),
                heroImage: 'https://placehold.co/800x600/cccccc/333333?text=New+Project', 
                accentColor: 'bg-gray-500', 
                isHidden: true, // New projects start as hidden/draft
                caseStudy: {
                    client: '', 
                    role: '', 
                    duration: '',
                    brief: 'This is a new project waiting for your custom brief. Check the "Hide Project" box to make it visible on the live site.',
                    sections: [
                        { 
                            id: 'new-section-1', 
                            title: '01. Getting Started', 
                            content: 'Describe the challenge here.',
                            media: ''
                        }
                    ],
                }
            };
            currentProjects.push(newProject);
            renderProjectList();
            selectProject(newId);
        }

        function saveChanges() {
            if (!selectedProject) return;
            
            try {
                // 1. Update General Info fields
                selectedProject.title = document.getElementById('title').value;
                selectedProject.category = document.getElementById('category').value;
                selectedProject.year = document.getElementById('year').value;
                selectedProject.heroImage = document.getElementById('heroImage').value;
                selectedProject.accentColor = document.getElementById('accentColor').value;
                selectedProject.isHidden = document.getElementById('isHidden').checked; // Save HIDE status
                
                // 2. Update Modal Intro & Details
                selectedProject.caseStudy.brief = document.getElementById('brief').value;

                // Update Client/Role/Duration (only save if enabled)
                selectedProject.caseStudy.client = document.getElementById('enableClient').checked ? document.getElementById('client').value : '';
                selectedProject.caseStudy.role = document.getElementById('enableRole').checked ? document.getElementById('role').value : '';
                selectedProject.caseStudy.duration = document.getElementById('enableDuration').checked ? document.getElementById('duration').value : '';
                
                // 3. Rebuild sections from dynamic fields
                const sectionsContainer = document.getElementById('sections-container');
                const newSections = [];
                sectionsContainer.querySelectorAll('.section-card').forEach((card, index) => {
                    const titleInput = card.querySelector('.section-title-input').value;
                    const contentInput = card.querySelector('.section-content-input').value;
                    const mediaInput = card.querySelector('.section-media-input').value;

                    // Reconstruct section ID and title numbering
                    const baseId = titleInput.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                    const newTitle = `${String(index + 1).padStart(2, '0')}. ${titleInput.replace(/^\d{2}\. /, '').trim()}`; // Ensures numbering prefix is updated

                    newSections.push({
                        id: baseId || `section-${index + 1}`,
                        title: newTitle,
                        content: contentInput,
                        media: mediaInput
                    });
                });
                selectedProject.caseStudy.sections = newSections;

                // 4. Save to localStorage and update output
                localStorage.setItem('portfolioProjects', JSON.stringify(currentProjects));
                renderProjectList(); // Update the project list names
                updateJSOutput(); // Generate the final output code
                
                // 5. Automatically copy the generated code to the clipboard
                copyToClipboard('js-output');

                // Provide confirmation that the code is ready to paste
                // ALERT: Using a safe, modal-style alert for the Canvas environment
                alert('SUCCESS: Project data saved locally and the new JavaScript code array has been copied to your clipboard. Switch to projects_data.js and replace the array content.');
                
            } catch (error) {
                alert('ERROR: Could not save changes. Please check all fields for valid input.');
                console.error(error);
            }
        }
        
        // --- Dynamic Section Rendering ---

        function renderSections() {
            const container = document.getElementById('sections-container');
            container.innerHTML = '';
            
            selectedProject.caseStudy.sections.forEach((section, index) => {
                container.appendChild(buildSectionHTML(section, index));
            });
        }

        function buildSectionHTML(section, index) {
            const card = document.createElement('div');
            card.className = 'section-card';
            card.setAttribute('data-index', index);
            
            const mediaPreview = section.media ? `<img src="${section.media}" class="w-20 h-auto rounded mt-2 border" onerror="this.onerror=null; this.src='https://placehold.co/80x20/ef4444/ffffff?text=Error';" />` : '';

            card.innerHTML = `
                <div class="flex justify-between items-center mb-3 border-b pb-2">
                    <h4 class="font-bold text-lg text-indigo-800">Section ${index + 1}</h4>
                    <button type="button" onclick="removeSection(${index})" class="text-sm font-medium text-red-600 hover:text-red-800">
                        Remove
                    </button>
                </div>
                
                <label class="block text-sm font-medium text-gray-700 mt-2">Section Title (e.g., 'The Problem & Goal')</label>
                <input type="text" value="${section.title.replace(/^\d{2}\. /, '').trim() || ''}" class="section-title-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Enter title without numbering">
                
                <label class="block text-sm font-medium text-gray-700 mt-4">Section Copy</label>
                <textarea rows="4" class="section-content-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">${section.content || ''}</textarea>
                
                <label class="block text-sm font-medium text-gray-700 mt-4">Media/Image URL (Optional)</label>
                <input type="url" value="${section.media || ''}" class="section-media-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Paste image URL here">
                ${mediaPreview}
            `;
            return card;
        }

        function addSectionField() {
            const sections = selectedProject.caseStudy.sections;
            const newIndex = sections.length;
            const newSection = {
                id: `new-section-${newIndex + 1}`,
                title: `${String(newIndex + 1).padStart(2, '0')}. NEW SECTION`,
                content: 'Add new content here.',
                media: ''
            };
            sections.push(newSection);
            renderSections();
        }

        function removeSection(indexToRemove) {
            if (confirm(`Are you sure you want to remove Section ${indexToRemove + 1}?`)) {
                selectedProject.caseStudy.sections.splice(indexToRemove, 1);
                renderSections();
            }
        }

        // --- Output Generation and Copy ---

        function updateJSOutput() {
            // 1. Generate the raw array string using standard JSON.stringify (produces double quotes)
            let rawArrayString = JSON.stringify(currentProjects, null, 4);

            // 2. Define the keys that can have their quotes removed (property names)
            const keysToUnquote = ['id', 'title', 'category', 'year', 'heroImage', 'accentColor', 'isHidden', 'caseStudy', 'client', 'role', 'duration', 'brief', 'sections', 'content', 'media'];
            
            // 3. Remove double quotes around OBJECT KEYS ONLY (preserving quotes around string values)
            keysToUnquote.forEach(key => {
                // Regex to find: "key":
                // This targets the double quote produced by JSON.stringify
                const regex = new RegExp(`"${key}":`, 'g');
                rawArrayString = rawArrayString.replace(regex, `${key}:`);
            });
            
            // 4. Wrap the array string with the necessary declaration for full file replacement
            const finalOutput = `const ALL_PROJECTS = ${rawArrayString};`;
            
            // Set the textarea value to the complete file content
            document.getElementById('js-output').value = finalOutput;
        }
        
        function copyToClipboard(elementId) {
            const copyText = document.getElementById(elementId);
            copyText.select();
            // Use fallback method for clipboard copy due to browser restrictions
            try {
                const successful = document.execCommand('copy');
            } catch (err) {
                console.error('Fallback copy failed', err);
            }
        }

        // Initialize on load
        window.onload = initializeApp;
    </script>
</body>
</html>